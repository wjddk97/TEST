# 네트워크의 전체 흐름

## 랜 카드에서의 데이터 전달과 처리

### 1. 네트워크의 구성
|                            |                                              |             
|----------------------------|----------------------------------------------|
|응용 계층(세션 계층, 표현 계층 포함)|애플리케이션 등에서 사용하는 데이터를 송수신하는 데 필요하다. |
|전송 계층                      |목적지에 데이터를 정확하게 전달하는 데 필요하다.          |
|네트워크 계층                   |다른 네트워크에 있는 목적지에 데이터를 전달하는 데 필요하다. |
|데이터 링크 계층                 |랜에서 데이터를 송수신하는 데 필요하다.                 |
|물리 계층                       |데이터를 전기 신호로 변환하는 데 필요하다.              |        

----

<br>

### 2. 컴퓨터의 데이터가 전기 신호로 변환되는 과정

![image](https://user-images.githubusercontent.com/87896537/147571071-3bdd3243-09f2-4d3e-928f-8ea374e8c559.png)


 먼저 웹 사이트에 접속해야 하므로 **응용 계층**에서 시작한다. <br>
 웹 브라우저에 URL을 입력하고 Enter 키를 누르면 캡슐화가 시작된다.(3-way handshake는 이미 완료되어 연결이 확립되어 있다고 가정) <br>
 응용 계층에서는 웹 서버에 있는 html 데이터를 얻어야 하므로 HTTP 메시지를 보낸다. <br>
 
> TCP 3 Way Handshake는 TCP/IP프로토콜을 이용해서 통신을 하는 응용프로그램이 데이터를 전송하기 전에 
> 먼저 정확한 전송을 보장하기 위해 상대방 컴퓨터와 사전에 세션을 수립하는 과정을 의미한다..

<br>

 이 데이터가 **전송 계층**에 전달된다. <br>
 전송 계층에서는 TCP 헤더가 붙는다. <br>
 TCP 헤더의 출발지 포트 번호(웹 브라우저)는 잘 알려진 포트가 아닌 포트(1025번 이상인 포트) 중에서 무작위로 선택된다. <br>
 목적지 포트 번호는 HTTP에 해당하는 80번 포트가 된다. 이렇게 TCP 헤더가 붙어 세그먼트가 되어 네트워크 계층에 전달된다. <br>

<br>

 **네트워크 계층**에서는 전송 계층에서 전달받은 세그먼트(데이터)에 IP 헤더가 붙는다. <br>
 IP 헤더에서는 출발지 IP 주소와 목적지 IP 주소가 추가된다. <br>
 이렇게 IP 헤더가 붙은 데이터를 IP 패킷이라고 한다. <br>
 IP 패킷은 데이터 링크 계층으로 전달된다. <br>
 
 <br>

 **데이터 링크 계층**에서는 이더넷 헤더가 추가된다. <br> 
 이더넷 헤더가 있는 데이터는 이더넷 프레임이라고 한다. <br>
 그 후 물리 계층에서 전기 신호로 변환되어 네트워크로 전송된다. <br>
 
 <br>

 **물리 계층**에서 전기 신호로 변환되는 과정에서 랜 카드가 사용된다. <br>

<br> 

> - 웹에 접속할 때는 OSI 모델의 상위 계층부터 캡슐화가 이루어진다.
> - 웹 서버에 요청을 보낼 때는 HTTP를 사용한다.
> - 웹 서버에 있는 html 파일을 요청하는 경우에는 HTTP 메시지를 보낸다.
> - 전송 계층에서는 TCP 헤더가 추가되며 이를 세그먼트라고 부른다.
> - 네트워크 계층에서는 IP 헤더가 추가되며 이를 IP 패킷이라고 부른다.
> - 데이터 링크 계층에서는 이더넷 헤더와 트레일러(FCS)가 추가되며 이를 이더넷 프레임이라고 부른다.
> - 물리 계층에서는 데이터가 전기 신호로 변환되어 전송된다.

<br>

## 스위치와 라우터에서의 데이터 전달과 처리

![image](https://user-images.githubusercontent.com/87896537/147571007-799a6369-a102-415e-9c5a-8f0cc1089889.png)

### 1. 스위치에서의 데이터 전달과 처리
스위치 A는 데이터 링크 계층에서 데이터를 전기 신호로 변환하여 라우터 A로 전송한다. 

### 2. 라우터에서의 데이터 전달과 처리
스위치 A에서 데이터가 전기 신호로 변환되어 케이블을 통해 라우터 A에 도착하면 라우터 A는 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다. <br>
이 때 주소가 같으면 이더넷 헤더와 트레일러를 분리하는 역캡슐화를 수행한다. <br> 
다음으로 네트워크 계층에 전달하고 자신의 라우팅 테이블과 목적지 IP 주소를 비교한다. <br>

라우터 A의 라우팅 테이블에서 목적지 IP 주소의 경로를 알 수 있으면 라우팅을 할 수 있다. <br>
출발지 IP 주소를 라우터의 외부 IP 주소인 172.16.0.1(위의 그림 참고)로 변경한다. <br>
그 후, 데이터 링크 계층으로 전달하여 라우터 B로 보내지도록 이더넷 헤더와 트레일러를 붙인 후에 물리 계층에서 데이터를 전기 신호로 변환하여 네트워크로 전달한다. <br>

전기 신호로 변환된 데이터가 케이블을 통해 라우터 A에서 라우터 B로 보내진다. <br>
데이터가 도착하면 라우터 B는 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다. <br>
주소가 같으면 이더넷 헤더와 트레일러를 분리하는 역캡슐화를 수행한다. <br>
그 후, 네트워크 계층으로 전달되면 자신의 라우팅 테이블과 목적지 IP 주소를 비교한다. <br>
라우팅이 가능하면 출발지 IP 주소를 라우터 B의 내부 IP 주소인 192.168.0.1로 변경한다. <br>
그런 다음 데이터 링크 계층에 전달하여 스위치에 전달되도록 이더넷 헤더와 트레일러(FCS)를 붙인 후 물리 계층에서 데이터를 전기 신호로 변환하여 네트워크로 전달한다.<br>

해당 데이터는 라우터 B에서 스위치 B로 전달된다. 스위치 B는 전기 신호를 데이터 링크 계층에서 처리하고 웹 서버에 데이터를 전기 신호로 전달한다. <br>

- 스위치 내에 대응되는 OSI 모델의 계층은 물리 계층과 데이터 링크 계층이다.
- 라우터 내에 대응되는 OSI 모델의 계층은 물리 계층, 데이터 링크 계층, 네트워크 계층이다.

> 라우팅은 패킷을 목적지 컴퓨터까지 보낼 때 최적의 경로를 선택하여 전송하는 것을 뜻한다.

<br>

## 웹 서버에서의 데이터 전달과 처리

 데이터가 전기 신호로 웹 서버에 도착하면 웹 서버는 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다. <br>
 주소가 같으면 이더넷 헤더와 트레일러를 분리하고 네트워크 계층에 전달한다. <br>

 네트워크 계층에서는 목적지 IP 주소와 웹 서버의 IP 주소가 같은지 확인한다. 주소가 같으면 IP 헤더를 분리하고 전송 계층에 전달한다. <br>

 전송 계층에서는 목적지 포트 번호를 확인하여 어떤 애플리케이션으로 전달해야 되는지 판단하고 TCP 헤더를 분리하여 응용 계층에 전달한다. <br>
 
 이렇게 마지막으로 응용 계층에 데이터가 전달된다. <br>

- 웹 서버 내에 해당하는 OSI 모델 계층은 물리 계층, 데이터 링크 계층, 네트워크 계층, 전송 계층, 응용 계층이다. <br>

<br>

## 정적 라우팅과 동적 라우팅

### 1. 정적 라우팅
 정적 라우팅은 관리자가 미리 라우팅 테이블에 경로를 수동으로 추가하는 방법이다. <br> 
 목적지 까지의 경로를 고정하거나 목적지까지의 경로가 하나로 한정되는 경우에 사용한다. <br>
 네트워크에 존재하는 모든 목적지 네트워크의 정보를 라우터에 알려줘야 하므로 소규모 네트워크에서 사용된다. <br>

#### 장점
- 라우팅 정보가 교환되지 않아 대역폭에 대한 부담이 적다
- 라우팅 정보가 네트워크로 전달되지 않으므로 보안 유지에 좋다.

#### 단점
- 동적인 반영이 이루어지지 않아 경로에 장애가 발생해도 다른 경로로 우회할 수 없다.
- 이럴 경우 관리자가 설정을 하나하나 변경해야 한다.
 

### 2. 동적 라우팅
네트워크 변경을 자동으로 감지하여 라우팅 테이블을 업데이트하거나 네트워크 장애가 발생했을 때 라우터끼리 정보를 교환하여 최적의 경로로 전환하는 기능을 한다. <br>
정적 라우팅처럼 관리자가 라우팅 테이블에 경로를 수동으로 추가할 필요가 없다. <br>
대규모 네트워크에서는 라우터에 많은 경로가 등록되기 때문에 정적 라우팅을 지원하지 않고 동적 라우팅을 사용하여 경로를 자동으로 업데이트 한다.
